<div class="pc-container">
  <div class="pcoded-content pb" style="padding-bottom:90px;">
    <div class="page-header">
      <div class="page-block">
        <div class="row align-items-center">
          <div class="col-md-6" style="margin-top: 20px;">
            <div class="page-header-title">
              <h5 class="m-b-10">Update Case Status</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card mt-5">
      <div class="card-body">
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="col-md-12">
            <div class="row">
              <div class="col-md-10">

                <div class="row searchbypanel">
                  <div class="col-md-3  col-12 mb-3">
                    <label class="form-label"> District Name</label>
                    <sup class="text-danger top-0">*</sup>
                    <select id="district" formControlName="district" class="form-control form-select"
                      (change)="onDistrictChange($event)">
                      <option value="">Select</option>
                      <option *ngFor="let district of Districts" [value]="district.value">{{
                        district.text }}</option>
                    </select>

                  </div>
                  <div class="col-md-3  col-12 mb-3">
                    <label class="form-label"> Police Station</label>
                    <sup class="text-danger top-0">*</sup>
                    <select id="policeStation" formControlName="psCode" data-errormessage-custom-error=""
                      class="form-control form-select" [ngClass]="{ 'is-invalid': isSubmitted && f['psCode'].errors }">
                      <option value="">Select</option>
                      <option *ngFor="let policestation of policestations" [value]="policestation.value">{{
                        policestation.text }}</option>
                    </select>
                    @if (f['psCode'].errors && isSubmitted) {
                    <div class="invalid-feedback">
                      @if (f['psCode'].errors['required']) {
                      <div>Police Station is required</div>
                      }
                    </div>
                    }

                  </div>
                  <div class="col-md-3  col-12 mb-3">
                    <label class="form-label"> FIR No.</label>
                    <sup class="text-danger top-0">*</sup>
                    <input type="text" formControlName="firNumber" maxlength="7" tabindex="2" class="form-control "
                      [ngClass]="{ 'is-invalid': isSubmitted && f['firNumber'].errors }">
                    @if (f['firNumber'].errors && isSubmitted) {
                    <div class="invalid-feedback">
                      @if (f['firNumber'].errors['required'] && isSubmitted) {
                      <div>Fir Number is required</div>
                      }
                      @if (f['firNumber'].errors['pattern']) {
                      <div>Invalid Fir Number</div>
                      }
                    </div>
                    }
                  </div>
                  <div class="col-md-3  col-12 mb-3">
                    <label class="form-label">Year</label>
                    <sup class="text-danger top-0">*</sup>
                    <input type="text" formControlName="year" maxlength="4" tabindex="2" class="form-control "
                      [ngClass]="{ 'is-invalid': isSubmitted && f['year'].errors }">
                    @if (f['year'].errors && isSubmitted) {
                    <div class="invalid-feedback">
                      @if (f['year'].errors['required']) {
                      <div>Year is required</div>
                      }
                      @if (f['year'].errors['pattern']) {
                      <div>Invalid year</div>
                      }
                    </div>
                    }
                  </div>
                </div>
              </div>

              <div class="col-md-2 col-12 pt-4 mt-2">
                <button type="submit" class="btn btn-success text-white py-1">Search</button>
              </div>

            </div>
          </div>
        </form>
      </div>

    </div>
    <div class="row" *ngIf="isLoaded">
      <div class="col-sm-12  p-0">
        <div class="card">
          <div class="card-body pt-3">
            <p-table [value]="firdata" [paginator]="false" [rows]="20" [columns]="columns" [responsive]="true">
              <ng-template pTemplate="header">
                <tr>
                  <th>S.No</th>
                  <th>FIR Number</th>
                  <th>FIR Registration Date & Time</th>
                  <th>IO Name</th>
                  <th>IO Mobile</th>
                  <th>ACTS And Sections</th>
                  <th>FIR Status</th>
                  <th>Total Accused </th>
                  <th>Arrested </th>
                  <th>Not Arrested</th>
                  <th>Cancelled / Quashed</th>
                  <th>Untraced </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-rowData let-i="rowIndex">
                <tr>
                  <td>{{ i + 1 }}</td>
                  <td>
                    <a href="javascript:void(0)"
                      (click)="loadPillarData(rowData.firRegNum, rowData.FIRREGDATE, form.controls['firNumber'].value, form.controls['psCode'].value)">
                      {{ rowData.firShortNumber }}
                    </a>
                  </td>
                  <td>{{ rowData.FIRREGDATE }}</td>
                  <td>{{ rowData.IO_NAME }}</td>
                  <td>{{ rowData.IO_MOBILE_No }}</td>
                  <td>{{ rowData.ACTS_AND_SECTIONS }}</td>

                  <td>{{ rowData.firStatus }}</td>
                  <!-- For TotalArrested -->

                  <td [style.color]="rowData.TotalAccused > 0 ? '#7267EF' : ''"
                    [class.disabled]="rowData.TotalAccused === 0" [class.clickable]="rowData.TotalAccused !== 0"
                    (click)="rowData.TotalAccused !== 0 && ArrestedClickHandler('All')">
                    {{ rowData.TotalAccused }}
                  </td>
                  <td [style.color]="rowData.TotalArrested > 0 ? '#7267EF' : ''"
                    [class.disabled]="rowData.TotalArrested === 0" [class.clickable]="rowData.TotalArrested !== 0"
                    (click)="rowData.TotalArrested !== 0 && ArrestedClickHandler('Arrested')">
                    {{ rowData.TotalArrested }}
                  </td>

                  <!-- For TotalNotArrested -->
                  <td [style.color]="rowData.TotalNotArrested > 0 ? '#7267EF' : ''"
                    [class.disabled]="rowData.TotalNotArrested === 0" [class.clickable]="rowData.TotalNotArrested !== 0"
                    (click)="rowData.TotalNotArrested !== 0 && ArrestedClickHandler('NotArrested')">
                    {{ rowData.TotalNotArrested }}
                  </td>
                  <td>{{ rowData.IsCANCELLATION }}</td>
                  <td>{{ rowData.IsUNTRACED }}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
    <modal id="modal-othterpillerdata">
      <div class="modal-header">
        <button type="button" class="btn-close" (click)="modalService.close();"></button>
      </div>
      <div class="modal-body">
        <app-tab-container></app-tab-container>
      </div>
    </modal>

    <p-dialog [(visible)]="showPopup" [modal]="true" [responsive]="true" [style]="{ width: '80%' }" [closable]="true"
      (onShow)="resetPaginator()" (onHide)="closePopup()">

      <p-header>
        {{ AccusedDataPOPHeader }}
      </p-header>

      <div class="modal-body">
        <p-table #popupTable [columns]="popupColumns" [value]="popupData" [paginator]="true" [rows]="10"
          [first]="firstRowIndex" [rowsPerPageOptions]="[10, 20, 50]" [responsive]="true" [rowHover]="true">

          <ng-template pTemplate="header" let-columns>
            <tr>
              <th class="header-style">Sr. No</th>
              <th *ngFor="let col of columns" class="header-style" [hidden]="col.field === 'Sno'">
                {{ col.header }}
              </th>
              <th>Arrested Status</th>
              <th class="header-style">Photo</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
            <tr>
              <!-- Serial Number -->
              <td class="body-cell-style">{{ rowIndex + 1 }}</td>

              <!-- Dynamic Columns -->
              <td *ngFor="let col of columns" class="body-cell-style" [ngClass]="{ 'd-none': col.field === 'Sno' }">
                {{ rowData[col.field] ?? 'N/A' }}
              </td>

              <!-- Arrest Status -->
              <td class="body-cell-style">
                {{ rowData.IsArrested ? 'Arrested' : 'Not Arrested' }}
              </td>

              <!-- Photo -->
              <td class="body-cell-style">
                <img *ngIf="rowData.photo" [src]="'data:image/jpeg;base64,' + rowData.photo" alt="Photo"
                  style="width: 50px; height: 50px; object-fit: cover;" />
              </td>
            </tr>
          </ng-template>

        </p-table>
      </div>
    </p-dialog>

    <div class="linked-docs pt-2 only-court" *ngIf="otherPillarData?.length">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-12">

            <ul class="d-flex flex-row justify-content-between list-unstyled">
              <li>
                <div class="ic-nam">
                  <i class="fa fa-balance-scale" aria-hidden="true"></i>
                  <span>Court</span>
                </div>
                <div class="cnrnumbers"><a href="javascript:void(0)" (click)="loadCaseInformation(cnr)"
                    class="cnrnumber" *ngFor="let cnr of otherPillarData">
                    <strong>{{ cnr }}</strong>
                  </a>
                </div>
              </li>
            </ul>

          </div>
        </div>
      </div>
    </div>


    <div class="card mt-4" *ngIf="isCaseUpdateTable">
      <div class="card-body">
        <form [formGroup]="UpdateCaseForm" (ngSubmit)="onCaseSubmit()">
          <div id="searchByFilingNumber" class="row searchbypanel">
            <div class="col-md-3 col-12 mb-3">
              <label class="form-label">CNR Number</label>
              <sup class="text-danger top-0">*</sup>
              <select id="cnrSelect" class="form-control" formControlName="selectedCnr">
                <option value="">Select</option>
                <option *ngFor="let cnr of cnrList" [value]="cnr">{{ cnr }}</option>
              </select>
            </div>

            <div class="col-md-3 col-12 mb-3">
              <label class="form-label">Case Status</label>
              <sup class="text-danger top-0">*</sup>
              <select id="CaseStatusType" formControlName="CaseStatusType" (change)="onCaseStatusChange($event)"
                class="form-control form-select">
                <option value="">Select</option>
                <option *ngFor="let schedularType of CaseStatusTypes" [value]="schedularType.value">
                  {{schedularType.display}}
                </option>
              </select>
            </div>

            <div class="col-md-3 col-12 mb-3" *ngIf="isConvicted">
              <label class="form-label">Punishment In Month</label>
              <sup class="text-danger top-0">*</sup>
              <input type="text" class="form-control" id="Punishment" formControlName="Punishment" maxlength="7"
                placeholder="Enter punishment in months" (keypress)="allowOnlyNumbers($event)" />
            </div>
            <div class="col-md-3 col-12 mb-3">
              <label class="form-label">Remarks(Max 200 characters)</label>
              <sup class="text-danger top-0">*</sup>
              <textarea class="form-control" id="Remarks" formControlName="Remarks" placeholder="Enter remarks" rows="3"
                maxlength="200"></textarea>
            </div>
          </div>
          <div class="col-md-12 col-12 mb-3" style="text-align: right;">

            <button type="submit" class="btn btn-success text-white py-1">
              Update
            </button>

            <button type="reset" class="btn btn-secondary text-white py-1 ml-2">
              Reset
            </button>


          </div>
          <div class="col-sm-12 px-0"  *ngIf="CountData && CountData.length > 0">
            <div class="card">
              <div class="card-body">
                <p-table [value]="CountData" [paginator]="true" [rows]="25" [rowsPerPageOptions]="[25, 50, 75, 100]"
                  responsiveLayout="scroll">
                  <ng-template pTemplate="header">
                    <tr>
                      <th>S.No</th>
                      <th>CNR</th>
                      <th>Case Status</th>
                      <th>Punishment In Months</th>
                      <th>Remarks</th>
                      <th>Created Date</th>
                      <th>Delete</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-case let-rowIndex="rowIndex">
                    <tr>
                      <td>{{ rowIndex + 1 }}</td>
                      <td>{{ case.CNRNo }}</td>
                      <td>
                        <span>{{ case.CaseStatus }}</span>
                      </td>
                      <td>
                        <span>{{ case.PunishmentInMonths }}</span>
                      </td>
                      <td>
                        <span>{{ case.Remarks }}</span>
                      </td>
                      <td>
                        <span>{{ case.CreatedOn }}</span>
                      </td>
                       <td>
                      <i class="pi pi-trash text-danger cursor-pointer" 
                        (click)="onDelete(case.CNRNo)" 
                        title="Delete"></i>
                    </td>
                    </tr>
                  </ng-template>
                </p-table>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="6" class="text-center text-muted p-3">
                      No records found
                    </td>
                  </tr>
                </ng-template>
              </div>
            </div>
          </div>
        </form>

      </div>
    </div>



  

  </div>
</div>