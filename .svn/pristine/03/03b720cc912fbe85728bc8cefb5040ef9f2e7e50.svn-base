<!-- ip-whitelist-esakshya.component.html -->
<div class="pc-container">
  <div class="pcoded-content pb" style="padding-bottom:90px;">
    <div class="page-header">
      <div class="page-block">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="page-header-title">
              <h5 class="m-b-10">IP Whitelist ESsakshya Management</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-5">
    <div class="card">
      <div class=""row>
      <div class="col-md-12 text-right">
        <button pButton icon="pi pi-plus" label="Add New IP" 
                class="p-button-primary" (click)="showAddForm()"></button>
      </div>
    </div>
      <p-table [value]="ipAddresses" [paginator]="true" [rows]="10"
               [rowsPerPageOptions]="[10, 25, 50]" [loading]="isLoading"
               styleClass="p-datatable-striped p-datatable-gridlines">
        <ng-template pTemplate="header">
          <tr>
            <th class="header-style">Sr. No</th>
            <th [pSortableColumn]="'IpAddress'">IP Address <p-sortIcon field="IpAddress"></p-sortIcon></th>
            <th [pSortableColumn]="'Description'">Description <p-sortIcon field="Description"></p-sortIcon></th>
            <th [pSortableColumn]="'CreatedDate'"> Created Date <p-sortIcon field="CreatedDate"></p-sortIcon></th>
            <th [pSortableColumn]="'IsActive'">Status <p-sortIcon field="IsActive"></p-sortIcon></th>
            <th style="width: 120px">Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowIndex="rowIndex" let-ip>
          <tr>
            <td class="body-cell-style">{{ rowIndex + 1 }}</td>
            <td>{{ ip.IpAddress }}</td>
            <td>{{ ip.Description || '-' }}</td>
            <td>{{ ip.CreatedDate ? (ip.CreatedDate | date: 'yyyy-MM-dd HH:mm') : '-' }}</td>
            <td>
              <p-tag [severity]="ip.IsActive ? 'success' : 'danger'" 
                     [value]="ip.IsActive ? 'Active' : 'Inactive'"></p-tag>
            </td>
            <td>
              <div class="flex gap-2">
                <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-warning" 
                        (click)="showEditForm(ip)"></button>
                <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger" 
                        (click)="deleteIp(ip.Id)"></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="text-center p-4">
              No IP addresses found
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  </div>
  </div>

  <p-dialog [(visible)]="showForm" [style]="{width: '500px'}" [modal]="true"
  [draggable]="false" [resizable]="false"
  [header]="isEditing ? 'Edit IP Address' : 'Add New IP Address'">
<form [formGroup]="crudForm" (ngSubmit)="handleSubmit()" class="p-fluid">
<!-- Form content remains the same -->
<div class="field">
<label for="ipAddress">IP Address</label>
<input pInputText id="ipAddress" formControlName="ipAddress"
     [class]="{'ng-invalid ng-dirty': crudForm.get('ipAddress')?.invalid && 
     crudForm.get('ipAddress')?.touched}">
<small *ngIf="crudForm.get('ipAddress')?.invalid && 
           crudForm.get('ipAddress')?.touched" 
     class="p-error">
<span *ngIf="crudForm.get('ipAddress')?.errors?.['required']">Required field</span>
<span *ngIf="crudForm.get('ipAddress')?.errors?.['pattern']">
  Invalid IP address format
</span>
</small>
</div>

<div class="field">
<label for="description">Description</label>
<textarea pInputTextarea id="description" formControlName="description" 
        rows="3"></textarea>
</div>

<div class="field-checkbox" *ngIf="isEditing">
<p-checkbox [binary]="true" formControlName="isActive" 
          inputId="isActive"></p-checkbox>
<label for="isActive">Active</label>
</div>
</form>

<!-- Move footer template outside the form but inside dialog -->
<ng-template pTemplate="footer">
<button pButton type="button" label="Cancel" icon="pi pi-times"
    class="p-button-text" (click)="showForm = false"></button>
<button pButton type="submit" [label]="isEditing ? 'Update' : 'Create'" 
    icon="pi pi-check" class="p-button-primary"
    [disabled]="crudForm.invalid || isLoading"
    (click)="handleSubmit()"></button>
</ng-template>
</p-dialog>